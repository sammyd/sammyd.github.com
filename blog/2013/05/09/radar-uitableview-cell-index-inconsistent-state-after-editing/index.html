
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Radar: UITableView cell index inconsistent state after editing - i want my real name</title>
  <meta name="author" content="Sam Davies">

  
  <meta name="description" content="When working on UITableView I came across a bug in iOS, and have just got around
to filing my first ever apple bug report. Under certain conditions &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sammyd.github.com/blog/2013/05/09/radar-uitableview-cell-index-inconsistent-state-after-editing">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="i want my real name" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34836648-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">i want my real name</a></h1>
  
    <h2>why are there so many of me on the internets?</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sammyd.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Radar: UITableView Cell Index Inconsistent State After Editing</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-09T08:59:00+01:00" pubdate data-updated="true">May 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>When working on <code>UITableView</code> I came across a bug in iOS, and have just got around
to filing my first ever apple bug report. Under certain conditions it’s possible
to get the index paths of cells in the table to become inconsistent with the content.</p>

<p>Filed as rdar://13846681 and on <a href="http://openradar.appspot.com/13846681">OpenRadar</a>.</p>

<h3 id="summary">Summary</h3>

<p>It’s possible to get a <code>UITableView</code> with differing cell heights into a state
where the cell index paths are inconsistent with the datasource.</p>

<!-- more -->

<h3 id="steps-to-reproduce">Steps to Reproduce</h3>

<ol>
  <li>Create a <code>UITableView</code> in which the topmost cell is over twice the height of
the one immediately below it.</li>
  <li>Enable editing (specifically we want row reordering).</li>
  <li>Enter edit mode and scroll the table down so that you can only just see the
reordering grabber on the top cell.</li>
  <li>Tap the grabber. This will switch cells 0 and 1 (due to the height difference).</li>
</ol>

<p>The problem occurs only when the row switch causes a row to disappear off screen
(hence why we need the top row to be over double the height of the one below it).</p>

<h3 id="expected-results">Expected Results</h3>

<p>The <code>tableView:moveRowAtIndexPath:toIndexPath:</code> datasource method should be called
with the correct index paths, and the index paths of the cells in the table should
be updated appropriately.</p>

<h3 id="actual-results">Actual Results</h3>

<p>The datasource method is called correctly, but the cells in the table are left with
inconsistent index paths.</p>

<h3 id="regression">Regression</h3>

<p>Tested in iOS 4, 5 &amp; 6 with the same results.</p>

<h3 id="notes">Notes</h3>

<p>I have attached a sample project which demonstrates this. To see the effects:</p>

<ol>
  <li>Open the project</li>
  <li>Click the edit button</li>
  <li>Scroll the table down so that the grabber icon is only just visible for the
top cell (cell 0).</li>
  <li>Single tap the reordering grabber.</li>
</ol>

<p>The table now has an inconsistent index path state. The log status button shows
the index path (row) for each of the cells currently visible table, and the
corresponding index of the content of that cell in the backing array. These should
always match. Pressing it after the above actions will reveal that this isn’t the
case, and if you scroll back to the top of the table and log the status again
you’ll see that some of the cell content is repeated. Further scrolling of the
table will cause blank rows to appear etc.</p>

<h2 id="sample-project">Sample project</h2>

<p>The sample project which I uploaded is available on GitHub at
<a href="https://github.com/sammyd/UITableView-RadarSample">github.com/sammyd/UITableView-RadarSample</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sam Davies</span></span>

      








  


<time datetime="2013-05-09T08:59:00+01:00" pubdate data-updated="true">May 9<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bugreport/'>bugreport</a>, <a class='category' href='/blog/categories/ios/'>iOS</a>, <a class='category' href='/blog/categories/radar/'>radar</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sammyd.github.com/blog/2013/05/09/radar-uitableview-cell-index-inconsistent-state-after-editing/" data-via="iwantmyrealname" data-counturl="http://sammyd.github.com/blog/2013/05/09/radar-uitableview-cell-index-inconsistent-state-after-editing/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/04/22/why-buy-a-thermometer-when-you-can-build-one/" title="Previous Post: Why buy a thermometer when you can build one?">&laquo; Why buy a thermometer when you can build one?</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/09/radar-uitableview-cell-index-inconsistent-state-after-editing/">Radar: UITableView cell index inconsistent state after editing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/22/why-buy-a-thermometer-when-you-can-build-one/">Why buy a thermometer when you can build one?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/21/sourcetree-and-gerrit/">SourceTree and Gerrit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/10/building-a-range-selector-with-shinobi-charts-part-iv-adding-a-value-tracking-annotation/">Building a range selector with ShinobiCharts: Part IV - Adding a value-tracking annotation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/19/building-a-range-selector-with-shinobi-charts-part-iii-adding-momentum/">Building a range selector with ShinobiCharts: Part III - Adding momentum</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sammyd">@sammyd</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sammyd',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101617378418592701939?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Sam Davies -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'iwantmyrealname';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sammyd.github.com/blog/2013/05/09/radar-uitableview-cell-index-inconsistent-state-after-editing/';
        var disqus_url = 'http://sammyd.github.com/blog/2013/05/09/radar-uitableview-cell-index-inconsistent-state-after-editing/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
