<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Visualising ConAir data with Cubism.js</title>
    <meta name="description" content="iwantmyrealname - so I can use google to index things I fixed and then promptly forgot" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/images/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/images/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/images/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/images/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/images/icons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/assets/images/icons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/assets/images/icons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/assets/images/icons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/assets/images/icons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/assets/images/icons/favicon-128.png" sizes="128x128" />

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="iwantmyrealname" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Visualising ConAir data with Cubism.js" />
    <meta property="og:description" content="so I can use google to index things I fixed and then promptly forgot" />
    <meta property="og:url" content="" />
    
    <meta property="og:image" content="http://iwantmyreal.name/assets/covers/all_the_way_down.jpg" />
    

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@iwantmyrealname"
    <meta name="twitter:title" content="Visualising ConAir data with Cubism.js" />
    <meta name="twitter:description" content="so I can use google to index things I fixed and then promptly forgot" />
    <meta name="twitter:url" content="" />
    
    <meta name="twitter:image:src" content="http://iwantmyreal.name/assets/covers/all_the_way_down.jpg" />
    

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "iwantmyrealname",
    "url": "http://iwantmyreal.name",
    
    "image": "http://iwantmyreal.name/assets/covers/all_the_way_down.jpg",
    
    "description": "so I can use google to index things I fixed and then promptly forgot"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="iwantmyrealname" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
                <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-speaking " role="presentation"><a href="/speaking">Speaking</a></li>
        <li class="nav-contact " role="presentation"><a href="/contact">Contact</a></li>
        
    </ul>
    <ul>
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
             
                <li class="" role="presentation"><a href="/tag/iOS">iOS</a></li>
            
        
            
        
             
                <li class="" role="presentation"><a href="/tag/shinobi">shinobi</a></li>
            
        
            
        
            
        
             
                <li class="" role="presentation"><a href="/tag/talks">talks</a></li>
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/covers/all_the_way_down.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/glasses.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Visualising ConAir data with Cubism.js</h1>
            <section class="post-meta">
            <!-- <a href=''>Sam Davies</a> -->
            <time class="post-date" datetime="2012-09-16">16 Sep 2012</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    <a href='/tag/ruby'>ruby</a> 
                
                    <a href='/tag/d3.js'>d3.js</a> 
                
                    <a href='/tag/cubism.js'>cubism.js</a> 
                
                    <a href='/tag/tempodb'>tempodb</a> 
                
                
            </section>
        </header>

        <section class="post-content">
            
            <p>This post is part of a series of blog posts detailing how I built a system
which records the temperature in our office. The parts are as follows:</p>

<ul>
  <li><a href="/blog/2012/09/23/measuring-the-temperature-with-an-arduino-and-a-thermistor">Measuring temperature with an Arduino</a>
describes how to use an Arduino and a thermistor to record the temperature.</li>
  <li><a href="/blog/2012/09/14/conair-the-quest-for-reasonable-office-air-con">ConAir</a>
gives an overview of the motivation behind the project, and runs through the
process of taking the readings from the arduino and publishes them to a TempoDB
database on the internet.</li>
  <li>This post describes building a proxy webservice for the TempoDB database, and
then visualising the temperature data using cubism.js</li>
  <li><a href="/blog/2012/12/11/an-ios-app-for-plotting-live-data-conair-ios">iOS App</a>
describes building an iOS app which pulls the data from the webservice created
in this app and uses ShinobiCharts to plot the result.</li>
</ul>

<hr />

<p>Hot on the tail of being able to record temperature readings from the
Arduino in the office, we can get some charting on the go.</p>

<p>This post describes building a <a href="http://square.github.com/cubism">cubism.js</a>
front end to a <a href="http://tempo-db.com/">TempoDB</a> API proxy we implement in
Sinatra. You can see the result running live on heroku at
<a href="http://sl-conair.herokuapp.com/">sl-conair</a>, and there’s a screenshot
below in case we’re working on the electronics and there is no data:</p>

<p><img src="/images/2012-09-16-sl-conair.png" alt="Conair" /></p>

<p>We have been using <a href="http://tempo-db.com/">TempoDB</a> to store the temperature
data points - it has a great API for querying your dataset, including
rollups, which are able to summarise your data at a resolution of your choice.
Unfortunately, TempoDB doesn’t yet allow public access to datasets - the
API requires authentication for both read and write. Therefore the first
part of this stage will be to build a proxy for the TempoDB API. We then
use Cubism.js to interface this proxied API.</p>

<!-- more -->

<h2 id="tempodb-proxy">TempoDB Proxy</h2>

<p>TempoDB provide a selection of API clients - we used the python one to upload
the data points as they are read off the Arduino. Here I’m going to use the
Ruby one - just ‘cos.</p>

<p>The following is part of a really simple Sinatra application which will
interface with the TempoDB API.</p>

<noscript><pre>400: Invalid request
</pre></noscript>
<script src="https://gist.github.com/3740067.js"> </script>

<p>We receive requests for data on <code class="highlighter-rouge">/data</code> with URL parameters <code class="highlighter-rouge">start</code>, <code class="highlighter-rouge">stop</code> and
<code class="highlighter-rouge">step</code>. The two timestamps are in a format which can be parsed by ruby’s <code class="highlighter-rouge">Time.parse</code>
method, whilst the step is measured in milliseconds. This is to fit nicely with
Cubism.js.</p>

<p>We convert the step into a string of a suitable format for the TempoDB client,
here, assuming that the step will always be an integer number of minute. We then
send the request to TempoDB.</p>

<p>As mentioned before, if you ask for data at a coarser level than that
at which it was recorded, TempoDB will “roll” it up for you. This is a
fantastic feature, and although the logic to perform this kind of operation isn’t
complex, this kind of operation can absorb days worth of optimisation time,
combined with the fiddling associated with working with date objects. Here,
we are telling TempoDB that the rollup function should be mean, although
other sensible collection operators are implemented too (e.g. count, sum,
max etc).</p>

<h2 id="discontinuous-data">Discontinuous Data</h2>

<p>If there is a discontinuity in your data, then TempoDB won’t perform
any interpolation - there will be gaps in what it returns. This is fine because
the data it returns consists of timestamp-value pairs.</p>

<p>This does however present an issue with Cubism.js, which doesn’t expect
discontinuities in the data, and in fact only works with an array of values,
ignoring timestamps.</p>

<p>Therefore we iterate through the array of datapoints returned by TempoDB
and if there is a temporal discontinuity, we interpolate suitable values. In this
instance we’ve chosen to linearly interpolate between the points either side
of the discontinuity.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span><span class="p">((</span><span class="n">next_time</span> <span class="o">-</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">abs</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
  <span class="c1"># Let's add the right number of values</span>
  <span class="n">points_needed</span> <span class="o">=</span> <span class="p">((</span><span class="n">next_time</span> <span class="o">-</span> <span class="n">current_time</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">step</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)).</span><span class="nf">floor</span>
  <span class="n">difference</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nf">value</span> <span class="o">-</span> <span class="n">val</span><span class="p">.</span><span class="nf">value</span>
  <span class="n">points_needed</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">response_data</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span> <span class="ss">value: </span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="nf">value</span> <span class="o">+</span> <span class="n">difference</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">points_needed</span><span class="p">.</span><span class="nf">to_f</span><span class="p">)</span> <span class="p">})</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<p>This particular endpoint will return a JSON array of hashes, each containing a
value key. The array will be in time order, and the elements represent
consecutive temperature readings, at the specified time interval, from start
to stop.</p>

<h2 id="cubismjs">Cubism.js</h2>

<p>Cubism is a time-series visualisation tool built on top of the brilliant
<a href="http://d3js.org/">d3.js</a> javascript library. d3.js works on the paradigm
of data driven websites - where the content and the style changes as events
occur within the data - whether it be a user interacting with it, or new
data points arriving. There are some awesome d3.js demos on their website
with fantastic visualisations - easily a way to waste an hour…</p>

<p><a href="http://square.github.com/cubism">Cubism.js</a> is a library developed by the
people at square for displaying just this kind of data. We are going to use
it to call our new API proxy.</p>

<p>Start with a div, within which we will place the chart:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chart"</span><span class="nt">&gt;&lt;/div&gt;</span></code></pre></figure>

<p>Cubism has the concept of a context, which manages the data requests and the 
UI elements.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">context</span><span class="o">=</span> <span class="nx">cubism</span><span class="p">.</span><span class="nx">context</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">serverDelay</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1">// Allow 2 mins server delay</span>
    <span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1">// Every 2 mins</span>
    <span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="mi">940</span><span class="p">)</span></code></pre></figure>

<p>The <code class="highlighter-rouge">serverDelay</code> specifies how long a delay we are prepared to wait before
querying the server for new data points, <code class="highlighter-rouge">step</code> defines how many milliseconds
you wish to wait between datapoints and <code class="highlighter-rouge">size</code> determines how many datapoints
(and therefore the width in pixels) you wish the chart to display.</p>

<p>Cubism manages the requests for the data points given the above settings, and
a data source. It has built-in datasource types for <a href="http://square.github.com/cube">Cube</a>
and <a href="http://graphite.wikidot.com">Graphite</a>, but we need to create our own:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">primary</span> <span class="o">=</span> <span class="nx">temperature</span><span class="p">(),</span>
    <span class="nx">esecondary</span> <span class="o">=</span> <span class="nx">primary</span><span class="p">.</span><span class="nx">shift</span><span class="p">(</span><span class="o">-</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">temperature</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">metric</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">stop</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">d3</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="s2">"/data/?start="</span> <span class="o">+</span> <span class="nx">start</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">()</span>
      <span class="o">+</span> <span class="s2">"&amp;stop="</span> <span class="o">+</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">()</span>
      <span class="o">+</span> <span class="s2">"&amp;step="</span> <span class="o">+</span> <span class="nx">step</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"unable to load data"</span><span class="p">));</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="p">}));</span>
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>We have defined 2 metrics - the second of them simply a time-shifted version of the
first. This is the simple kind of metric calculations provided by cubism, and
we’ll use this in the difference chart.</p>

<p>The <code class="highlighter-rouge">temperature()</code> function returns a context metric, which describes
how cubism should request data given start, stop and step values, and then
returns the data with a node.js inspired callback method. It’s all pretty
straightforward - we just plug in our particular API URL and then make sure
we process the results to pass an array of numerical values to the callback function.</p>

<p>That’s all the data handling work done. Now we just need to sort the GUI.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#chart"</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">div</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">div</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"div"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span> <span class="s2">"axis"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">axis</span><span class="p">().</span><span class="nx">orient</span><span class="p">(</span><span class="s2">"top"</span><span class="p">));</span>
    
    <span class="nx">div</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">".horizon"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">primary</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"div"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span> <span class="s2">"horizon"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">horizon</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">".2f"</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">title</span><span class="p">(</span><span class="s2">"Temperature"</span><span class="p">));</span>

    <span class="nx">div</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">".comparison"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">([[</span><span class="nx">primary</span><span class="p">,</span> <span class="nx">secondary</span><span class="p">]])</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"div"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span> <span class="s2">"comparison"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">comparison</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">formatChange</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">".1f%"</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">title</span><span class="p">(</span><span class="s2">"Daily Change"</span><span class="p">));</span>

    <span class="nx">div</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"div"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span> <span class="s2">"rule"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">rule</span><span class="p">());</span>
<span class="p">});</span>

<span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"focus"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">format</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="s2">".1f"</span><span class="p">);</span>
    <span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">".horizon .value"</span><span class="p">).</span><span class="nx">style</span><span class="p">(</span><span class="s2">"right"</span><span class="p">,</span> <span class="nx">i</span><span class="o">==</span> <span class="kc">null</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">format</span><span class="p">(</span><span class="nx">primary</span><span class="p">.</span><span class="nx">valueAt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">"\u00B0C"</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>This code first find the div we defined beforehand, adds an axis to the top
of it, adds a horizon chart and a comparison chart and a rule which follows the
cursor over the map.</p>

<p>The last block updates the value display to follow the rule.</p>

<p>Lots more info on setting this up is available on the cubism site, and there are plenty
of demos to hack around with.</p>

<h2 id="et-voila">Et voila…</h2>

<p>After all that work, you probably want to see it. You can check the current graph
at the site I’ve popped up on heroku <a href="http://sl-conair.herokuapp.com/">sl-conair</a>.
Be warned that this project is a work in progress - we’ve got loads we want to do
with the electronics, the data collection and the frontend, so it’s quite likely that
there will be gaps in the data.</p>

<p>Hope that was of interest. I still want to post about the electronics side of this
project - hopefully I’ll get round to that soon</p>

<p>sx</p>

<hr />

<h4 id="edit-11022013">Edit (11/02/2013)</h4>
<p>Added an additional introduction to pull together the ConAir posts.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="https://twitter.com/@iwantmyrealname" style="background-image: url(/assets/sam_headshot_small.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="https://twitter.com/@iwantmyrealname">Sam Davies</a></h4>
                
                
                <div class="author-meta">
                    <span class="author-location icon-location"> UK/Thailand</span> 
                    <span class="author-link icon-link"><a href="http://iwantmyreal.name"> iwantmyreal.name</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Visualising ConAir data with Cubism.js&amp;url=http://iwantmyreal.nameblog20120916visualising-conair-data-with-cubism-dot-js"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://iwantmyreal.nameblog20120916visualising-conair-data-with-cubism-dot-js"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://iwantmyreal.nameblog20120916visualising-conair-data-with-cubism-dot-js"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iwantmyrealname'; // required: replace example with your forum shortname
        var disqus_identifier = '/blog/2012/09/16/visualising-conair-data-with-cubism-dot-js';
        var disqus_url = 'http://iwantmyreal.name/blog/2012/09/16/visualising-conair-data-with-cubism-dot-js';
 
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/covers/all_the_way_down.jpg)" href="/blog/2012/09/23/measuring-the-temperature-with-an-arduino-and-a-thermistor">
            <section class="post">
                <h2>Measuring the temperature with an Arduino and a thermistor</h2>
                <p>I've written a couple of previous posts about reading the temperature from and Arduino, storing...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/covers/all_the_way_down.jpg)" href="/blog/2012/09/14/conair-the-quest-for-reasonable-office-air-con">
            <section class="post">
                <h2>ConAir: The quest for reasonable office air con</h2>
                <p>We’re all pretty genial people in our office, however, together with car parking, one of...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="">iwantmyrealname</a> &copy; 2016</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-34836648-1', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
